Роль: Ти — AI‑помічник розробки для Python‑проєкту "confluence-ai-platform".
Завдання: створити TaggingService, інтегрувати його з TaggingAgent, Confluence API та підготувати основу для ендпоінта авто‑тегування.

###############################################
# 1. Створити файл src/services/tagging_service.py
###############################################

Створи файл:
src/services/tagging_service.py

Встав у нього код:

--------------------------------
from src.agents.tagging_agent import TaggingAgent
from src.clients.confluence_client import ConfluenceClient
from src.core.logging.logger import get_logger

logger = get_logger(__name__)

class TaggingService:
    def __init__(self, confluence_client: ConfluenceClient = None, tagging_agent: TaggingAgent = None):
        self.confluence = confluence_client or ConfluenceClient()
        self.agent = tagging_agent or TaggingAgent()

    async def auto_tag_page(self, page_id: str, dry_run: bool = False) -> dict:
        """
        1. Завантажує сторінку з Confluence
        2. Витягує текст
        3. Викликає TaggingAgent
        4. Оновлює теги (якщо не dry_run)
        5. Повертає результат
        """

        logger.info(f"[TaggingService] Fetching page {page_id}")
        page = await self.confluence.get_page(page_id)

        if not page:
            logger.error(f"[TaggingService] Page {page_id} not found")
            return {"status": "error", "message": "Page not found"}

        text = page.get("body", {}).get("storage", {}).get("value", "")
        logger.debug(f"[TaggingService] Extracted text length: {len(text)}")

        logger.info(f"[TaggingService] Calling TaggingAgent for page {page_id}")
        tags = await self.agent.suggest_tags(text)

        logger.info(f"[TaggingService] Suggested tags: {tags}")

        if dry_run:
            logger.info(f"[TaggingService] Dry-run mode enabled, skipping update for page {page_id}")
            return {"status": "ok", "dry_run": True, "tags": tags}

        logger.info(f"[TaggingService] Updating labels for page {page_id}")
        await self.confluence.update_labels(page_id, tags)

        return {"status": "ok", "tags": tags}
--------------------------------

###############################################
# 2. Переконатися, що існує ConfluenceClient
###############################################

Перевір, що існує файл:
src/clients/confluence_client.py

Переконайся, що в ньому є методи:
- get_page(page_id)
- update_labels(page_id, tags)

Якщо методів немає — створи заглушки:

--------------------------------
async def get_page(self, page_id: str) -> dict:
    raise NotImplementedError

async def update_labels(self, page_id: str, tags: dict):
    raise NotImplementedError
--------------------------------

###############################################
# 3. Створити роутер для авто-тегування
###############################################

Відкрий файл:
src/api/routers/tagging.py

Заміні його вміст на:

--------------------------------
from fastapi import APIRouter
from src.services.tagging_service import TaggingService

router = APIRouter(prefix="/pages", tags=["tagging"])

@router.post("/{page_id}/auto-tag")
async def auto_tag_page(page_id: str, dry_run: bool = False):
    service = TaggingService()
    return await service.auto_tag_page(page_id, dry_run=dry_run)
--------------------------------

###############################################
# 4. Переконатися, що роутер підключений у main.py
###############################################

У файлі src/main.py має бути:

app.include_router(tagging_router)

###############################################
# 5. Оптимізувати імпорти та перевірити синтаксис
###############################################

Виконай:
- Optimize Imports
- Code Inspection (Syntax)
- Переконайся, що немає помилок у TaggingService та tagging.py

###############################################
# 6. Зробити commit і push
###############################################

git add .
git commit -m "Add TaggingService and auto-tag endpoint"
git push

###############################################
# Кінець інструкції
###############################################